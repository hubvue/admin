{"version":3,"sources":["../../../lib/doc/cell.js"],"names":["colCache","require","_","Enums","slideFormula","Cell","module","exports","row","column","address","Error","_row","_column","validateAddress","_address","_value","Value","create","Types","Null","style","_mergeStyle","_mergeCount","ValueType","prototype","worksheet","workbook","destroy","numFmt","value","font","alignment","border","fill","rowStyle","colStyle","number","col","$col$row","letter","type","effectiveType","toCsvString","addMergeRef","releaseMergeRef","isMerged","Merge","merge","master","release","unmerge","isMergedTo","isHyperlink","Hyperlink","hyperlink","v","getType","text","toString","html","escapeHtml","_upgradeToHyperlink","String","formula","result","formulaType","fullAddress","sheetName","name","names","definedNames","getNamesEx","self","removeAllNames","forEach","addEx","addName","removeName","removeEx","_dataValidations","dataValidations","dataValidation","find","add","model","NullValue","cell","NumberValue","Number","StringValue","replace","RichTextValue","richText","map","t","join","RichText","DateValue","Date","toISOString","HyperlinkValue","undefined","MergeValue","_master","FormulaValue","Formula","sharedFormula","validate","dependencies","ranges","match","cells","_getTranslatedFormula","FormulaType","Master","Shared","None","_translatedFormula","findCell","SharedStringValue","SharedString","BooleanValue","Boolean","ErrorValue","error","JSONValue","JSON","stringify","rawValue","sharedString","types","f","reduce","p","T"],"mappings":"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","file":"cell.js","sourcesContent":["/**\r\n * Copyright (c) 2014-2017 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar colCache = require('../utils/col-cache');\r\nvar _ = require('../utils/under-dash');\r\nvar Enums = require('./enums');\r\nvar { slideFormula } = require('../utils/shared-formula');\r\n\r\n// Cell requirements\r\n//  Operate inside a worksheet\r\n//  Store and retrieve a value with a range of types: text, number, date, hyperlink, reference, formula, etc.\r\n//  Manage/use and manipulate cell format either as local to cell or inherited from column or row.\r\n\r\nvar Cell = module.exports = function(row, column, address) {\r\n  if (!row || !column) {\r\n    throw new Error('A Cell needs a Row');\r\n  }\r\n\r\n  this._row = row;\r\n  this._column = column;\r\n\r\n  colCache.validateAddress(address);\r\n  this._address = address;\r\n\r\n  // TODO: lazy evaluation of this._value\r\n  this._value = Value.create(Cell.Types.Null, this);\r\n\r\n  this.style = this._mergeStyle(row.style, column.style, {});\r\n\r\n  this._mergeCount = 0;\r\n};\r\n\r\nCell.Types = Enums.ValueType;\r\n\r\nCell.prototype = {\r\n\r\n  get worksheet() {\r\n    return this._row.worksheet;\r\n  },\r\n  get workbook() {\r\n    return this._row.worksheet.workbook;\r\n  },\r\n\r\n  // help GC by removing cyclic (and other) references\r\n  destroy: function() {\r\n    delete this.style;\r\n    delete this._value;\r\n    delete this._row;\r\n    delete this._column;\r\n    delete this._address;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Styles stuff\r\n  get numFmt() {\r\n    return this.style.numFmt;\r\n  },\r\n  set numFmt(value) {\r\n    this.style.numFmt = value;\r\n  },\r\n  get font() {\r\n    return this.style.font;\r\n  },\r\n  set font(value) {\r\n    this.style.font = value;\r\n  },\r\n  get alignment() {\r\n    return this.style.alignment;\r\n  },\r\n  set alignment(value) {\r\n    this.style.alignment = value;\r\n  },\r\n  get border() {\r\n    return this.style.border;\r\n  },\r\n  set border(value) {\r\n    this.style.border = value;\r\n  },\r\n  get fill() {\r\n    return this.style.fill;\r\n  },\r\n  set fill(value) {\r\n    this.style.fill = value;\r\n  },\r\n\r\n  _mergeStyle: function(rowStyle, colStyle, style) {\r\n    var numFmt = (rowStyle && rowStyle.numFmt) || (colStyle && colStyle.numFmt);\r\n    if (numFmt) style.numFmt = numFmt;\r\n\r\n    var font = (rowStyle && rowStyle.font) || (colStyle && colStyle.font);\r\n    if (font) style.font = font;\r\n\r\n    var alignment = (rowStyle && rowStyle.alignment) || (colStyle && colStyle.alignment);\r\n    if (alignment) style.alignment = alignment;\r\n\r\n    var border = (rowStyle && rowStyle.border) || (colStyle && colStyle.border);\r\n    if (border) style.border = border;\r\n\r\n    var fill = (rowStyle && rowStyle.fill) || (colStyle && colStyle.fill);\r\n    if (fill) style.fill = fill;\r\n\r\n    return style;\r\n  },\r\n\r\n  // =========================================================================\r\n  // return the address for this cell\r\n  get address() {\r\n    return this._address;\r\n  },\r\n\r\n  get row() {\r\n    return this._row.number;\r\n  },\r\n  get col() {\r\n    return this._column.number;\r\n  },\r\n\r\n  get $col$row() {\r\n    return '$' + this._column.letter + '$' + this.row;\r\n  },\r\n\r\n\r\n  // =========================================================================\r\n  // Value stuff\r\n\r\n  get type() {\r\n    return this._value.type;\r\n  },\r\n\r\n  get effectiveType() {\r\n    return this._value.effectiveType;\r\n  },\r\n\r\n  toCsvString: function() {\r\n    return this._value.toCsvString();\r\n  },\r\n\r\n  // =========================================================================\r\n  // Merge stuff\r\n\r\n  addMergeRef: function() {\r\n    this._mergeCount++;\r\n  },\r\n  releaseMergeRef: function() {\r\n    this._mergeCount--;\r\n  },\r\n  get isMerged() {\r\n    return (this._mergeCount > 0) || (this.type === Cell.Types.Merge);\r\n  },\r\n  merge: function(master) {\r\n    this._value.release();\r\n    this._value = Value.create(Cell.Types.Merge, this, master);\r\n    this.style = master.style;\r\n  },\r\n  unmerge: function() {\r\n    if (this.type === Cell.Types.Merge) {\r\n      this._value.release();\r\n      this._value = Value.create(Cell.Types.Null, this);\r\n      this.style = this._mergeStyle(this._row.style, this._column.style, {});\r\n    }\r\n  },\r\n  isMergedTo: function(master) {\r\n    if (this._value.type !== Cell.Types.Merge) return false;\r\n    return this._value.isMergedTo(master);\r\n  },\r\n  get master() {\r\n    if (this.type === Cell.Types.Merge) {\r\n      return this._value.master;\r\n    }\r\n    return this; // an unmerged cell is its own master\r\n  },\r\n\r\n  get isHyperlink() {\r\n    return this._value.type === Cell.Types.Hyperlink;\r\n  },\r\n  get hyperlink() {\r\n    return this._value.hyperlink;\r\n  },\r\n\r\n  // return the value\r\n  get value() {\r\n    return this._value.value;\r\n  },\r\n  // set the value - can be number, string or raw\r\n  set value(v) {\r\n    // special case - merge cells set their master's value\r\n    if (this.type === Cell.Types.Merge) {\r\n      this._value.master.value = v;\r\n      return;\r\n    }\r\n\r\n    this._value.release();\r\n\r\n    // assign value\r\n    this._value = Value.create(Value.getType(v), this, v);\r\n  },\r\n  get text() {\r\n    return this._value.toString();\r\n  },\r\n  get html() {\r\n    return _.escapeHtml(this.text);\r\n  },\r\n  toString: function() {\r\n    return this.text;\r\n  },\r\n\r\n  _upgradeToHyperlink: function(hyperlink) {\r\n    // if this cell is a string, turn it into a Hyperlink\r\n    if (this.type === Cell.Types.String) {\r\n      this._value = Value.create(Cell.Types.Hyperlink, this, {\r\n        text: this._value.value,\r\n        hyperlink: hyperlink\r\n      });\r\n    }\r\n  },\r\n\r\n  // =========================================================================\r\n  // Formula stuff\r\n  get formula() {\r\n    return this._value.formula;\r\n  },\r\n  get result() {\r\n    return this._value.result;\r\n  },\r\n  get formulaType() {\r\n    return this._value.formulaType;\r\n  },\r\n\r\n  // =========================================================================\r\n  // Name stuff\r\n  get fullAddress() {\r\n    var worksheet = this._row.worksheet;\r\n    return {\r\n      sheetName: worksheet.name,\r\n      address: this.address,\r\n      row: this.row,\r\n      col: this.col\r\n    };\r\n  },\r\n  get name() {\r\n    return this.names[0];\r\n  },\r\n  set name(value) {\r\n    this.names = [value];\r\n  },\r\n  get names() {\r\n    return this.workbook.definedNames.getNamesEx(this.fullAddress);\r\n  },\r\n  set names(value) {\r\n    var self = this;\r\n    var definedNames = this.workbook.definedNames;\r\n    this.workbook.definedNames.removeAllNames(self.fullAddress);\r\n    value.forEach(function(name) {\r\n      definedNames.addEx(self.fullAddress, name);\r\n    });\r\n  },\r\n  addName: function(name) {\r\n    this.workbook.definedNames.addEx(this.fullAddress, name);\r\n  },\r\n  removeName: function(name) {\r\n    this.workbook.definedNames.removeEx(this.fullAddress, name);\r\n  },\r\n  removeAllNames: function() {\r\n    this.workbook.definedNames.removeAllNames(this.fullAddress);\r\n  },\r\n\r\n  // =========================================================================\r\n  // Data Validation stuff\r\n  get _dataValidations() {\r\n    return this.worksheet.dataValidations;\r\n  },\r\n\r\n  get dataValidation() {\r\n    return this._dataValidations.find(this.address);\r\n  },\r\n\r\n  set dataValidation(value) {\r\n    this._dataValidations.add(this.address, value);\r\n  },\r\n\r\n  // =========================================================================\r\n  // Model stuff\r\n\r\n  get model() {\r\n    var model = this._value.model;\r\n    model.style = this.style;\r\n    return model;\r\n  },\r\n  set model(value) {\r\n    this._value.release();\r\n    this._value = Value.create(value.type, this);\r\n    this._value.model = value;\r\n    if (value.style) {\r\n      this.style = value.style;\r\n    } else {\r\n      this.style = {};\r\n    }\r\n  }\r\n};\r\n\r\n// =============================================================================\r\n// Internal Value Types\r\n\r\nvar NullValue = function(cell) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Null\r\n  };\r\n};\r\nNullValue.prototype = {\r\n  get value() {\r\n    return null;\r\n  },\r\n  set value(value) {\r\n    // nothing to do\r\n  },\r\n  get type() {\r\n    return Cell.Types.Null;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.Null;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return '';\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return '';\r\n  }\r\n};\r\n\r\nvar NumberValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Number,\r\n    value: value\r\n  };\r\n};\r\nNumberValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Number;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.Number;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return '' + this.model.value;\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value.toString();\r\n  }\r\n};\r\n\r\nvar StringValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.String,\r\n    value: value\r\n  };\r\n};\r\nStringValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.String;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.String;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return '\"' + this.model.value.replace(/\"/g, '\"\"') + '\"';\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value;\r\n  }\r\n};\r\n\r\nvar RichTextValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.String,\r\n    value: value\r\n  };\r\n};\r\nRichTextValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  toString: function() {\r\n    return this.model.value.richText.map(function(t) {\r\n      return t.text;\r\n    }).join('');\r\n  },\r\n  get type() {\r\n    return Cell.Types.RichText;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.RichText;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return '\"' + this.text.replace(/\"/g, '\"\"') + '\"';\r\n  },\r\n  release: function() {\r\n  }\r\n};\r\n\r\nvar DateValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Date,\r\n    value: value\r\n  };\r\n};\r\nDateValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Date;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.Date;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return this.model.value.toISOString();\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value.toString();\r\n  }\r\n};\r\n\r\nvar HyperlinkValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Hyperlink,\r\n    text: value ? value.text : undefined,\r\n    hyperlink: value ? value.hyperlink : undefined\r\n  };\r\n};\r\nHyperlinkValue.prototype = {\r\n  get value() {\r\n    return {\r\n      text: this.model.text,\r\n      hyperlink: this.model.hyperlink\r\n    };\r\n  },\r\n  set value(value) {\r\n    this.model.text = value.text;\r\n    this.model.hyperlink = value.hyperlink;\r\n  },\r\n\r\n  get text() {\r\n    return this.model.text;\r\n  },\r\n  set text(value) {\r\n    this.model.text = value;\r\n  },\r\n  get hyperlink() {\r\n    return this.model.hyperlink;\r\n  },\r\n  set hyperlink(value) {\r\n    this.model.hyperlink = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Hyperlink;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.Hyperlink;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return this.model.hyperlink;\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.text;\r\n  }\r\n};\r\n\r\nvar MergeValue = function(cell, master) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Merge,\r\n    master: master ? master.address : undefined\r\n  };\r\n  this._master = master;\r\n  if (master) {\r\n    master.addMergeRef();\r\n  }\r\n};\r\nMergeValue.prototype = {\r\n  get value() {\r\n    return this._master.value;\r\n  },\r\n  set value(value) {\r\n    if (value instanceof Cell) {\r\n      if (this._master) {\r\n        this._master.releaseMergeRef();\r\n      }\r\n      value.addMergeRef();\r\n      this._master = value;\r\n    } else {\r\n      this._master.value = value;\r\n    }\r\n  },\r\n\r\n  isMergedTo: function(master) {\r\n    return master === this._master;\r\n  },\r\n  get master() {\r\n    return this._master;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Merge;\r\n  },\r\n  get effectiveType() {\r\n    return this._master.effectiveType;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return '';\r\n  },\r\n  release: function() {\r\n    this._master.releaseMergeRef();\r\n  },\r\n  toString: function() {\r\n    return this.value.toString();\r\n  }\r\n};\r\n\r\nvar FormulaValue = function(cell, value) {\r\n  this.cell = cell;\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Formula,\r\n    formula: value ? value.formula : undefined,\r\n    sharedFormula: value ? value.sharedFormula : undefined,\r\n    result: value ? value.result : undefined\r\n  };\r\n};\r\nFormulaValue.prototype = {\r\n  get value() {\r\n    return this.model.formula ? {\r\n      formula: this.model.formula,\r\n      result: this.model.result,\r\n    } : {\r\n      sharedFormula: this.model.sharedFormula,\r\n      result: this.model.result,\r\n    };\r\n  },\r\n  set value(value) {\r\n    this.model.formula = value.formula;\r\n    this.model.sharedFormula = value.sharedFormula;\r\n    this.model.result = value.result;\r\n  },\r\n  validate: function(value) {\r\n    switch (Value.getType(value)) {\r\n      case Cell.Types.Null:\r\n      case Cell.Types.String:\r\n      case Cell.Types.Number:\r\n      case Cell.Types.Date:\r\n        break;\r\n      case Cell.Types.Hyperlink:\r\n      case Cell.Types.Formula:\r\n      default:\r\n        throw new Error('Cannot process that type of result value');\r\n    }\r\n  },\r\n  get dependencies() {\r\n    // find all the ranges and cells mentioned in the formula\r\n    var ranges = this.formula.match(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\\d{1,4}:[A-Z]{1,3}\\d{1,4}/g);\r\n    var cells = this.formula.replace(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\\d{1,4}:[A-Z]{1,3}\\d{1,4}/g, '')\r\n      .match(/([a-zA-Z0-9]+!)?[A-Z]{1,3}\\d{1,4}/g);\r\n    return {\r\n      ranges: ranges,\r\n      cells: cells\r\n    };\r\n  },\r\n  get formula() {\r\n    return this.model.formula ||\r\n      this._getTranslatedFormula();\r\n  },\r\n  set formula(value) {\r\n    this.model.formula = value;\r\n  },\r\n  get formulaType() {\r\n    if (this.model.formula) {\r\n      return Enums.FormulaType.Master;\r\n    }\r\n    if (this.model.sharedFormula) {\r\n      return Enums.FormulaType.Shared;\r\n    }\r\n    return Enums.FormulaType.None;\r\n  },\r\n  get result() {\r\n    return this.model.result;\r\n  },\r\n  set result(value) {\r\n    this.model.result = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Formula;\r\n  },\r\n  get effectiveType() {\r\n    var v = this.model.result;\r\n    if ((v === null) || (v === undefined)) {\r\n      return Enums.ValueType.Null;\r\n    } else if ((v instanceof String) || (typeof v === 'string')) {\r\n      return Enums.ValueType.String;\r\n    } else if (typeof v === 'number') {\r\n      return Enums.ValueType.Number;\r\n    } else if (v instanceof Date) {\r\n      return Enums.ValueType.Date;\r\n    } else if (v.text && v.hyperlink) {\r\n      return Enums.ValueType.Hyperlink;\r\n    } else if (v.formula) {\r\n      return Enums.ValueType.Formula;\r\n    }\r\n\r\n    return Enums.ValueType.Null;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  _getTranslatedFormula() {\r\n    if (!this._translatedFormula && this.model.sharedFormula) {\r\n      var worksheet = this.cell.worksheet;\r\n      var master = worksheet.findCell(this.model.sharedFormula);\r\n      this._translatedFormula = master &&\r\n        slideFormula(master.formula, master.address, this.model.address);\r\n    }\r\n    return this._translatedFormula;\r\n  },\r\n  toCsvString: function() {\r\n    return '' + (this.model.result || '');\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.result ? this.model.result.toString() : '';\r\n  }\r\n};\r\n\r\nvar SharedStringValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.SharedString,\r\n    value: value\r\n  };\r\n};\r\nSharedStringValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.SharedString;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.SharedString;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return '' + this.model.value;\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value.toString();\r\n  }\r\n};\r\n\r\nvar BooleanValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Boolean,\r\n    value: value\r\n  };\r\n};\r\nBooleanValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Boolean;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.Boolean;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return this.model.value ? 1 : 0;\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value.toString();\r\n  }\r\n};\r\n\r\nvar ErrorValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.Error,\r\n    value: value\r\n  };\r\n};\r\nErrorValue.prototype = {\r\n  get value() {\r\n    return this.model.value;\r\n  },\r\n  set value(value) {\r\n    this.model.value = value;\r\n  },\r\n  get type() {\r\n    return Cell.Types.Error;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.Error;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return this.toString();\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value.error.toString();\r\n  }\r\n};\r\n\r\nvar JSONValue = function(cell, value) {\r\n  this.model = {\r\n    address: cell.address,\r\n    type: Cell.Types.String,\r\n    value: JSON.stringify(value),\r\n    rawValue: value\r\n  };\r\n};\r\nJSONValue.prototype = {\r\n  get value() {\r\n    return this.model.rawValue;\r\n  },\r\n  set value(value) {\r\n    this.model.rawValue = value;\r\n    this.model.value = JSON.stringify(value);\r\n  },\r\n  get type() {\r\n    return Cell.Types.String;\r\n  },\r\n  get effectiveType() {\r\n    return Cell.Types.String;\r\n  },\r\n  get address() {\r\n    return this.model.address;\r\n  },\r\n  set address(value) {\r\n    this.model.address = value;\r\n  },\r\n  toCsvString: function() {\r\n    return this.model.value;\r\n  },\r\n  release: function() {\r\n  },\r\n  toString: function() {\r\n    return this.model.value;\r\n  }\r\n};\r\n\r\n// Value is a place to hold common static Value type functions\r\nvar Value = {\r\n  getType: function(value) {\r\n    if ((value === null) || (value === undefined)) {\r\n      return Cell.Types.Null;\r\n    } else if ((value instanceof String) || (typeof value === 'string')) {\r\n      return Cell.Types.String;\r\n    } else if (typeof value === 'number') {\r\n      return Cell.Types.Number;\r\n    } else if (typeof value === 'boolean') {\r\n      return Cell.Types.Boolean;\r\n    } else if (value instanceof Date) {\r\n      return Cell.Types.Date;\r\n    } else if (value.text && value.hyperlink) {\r\n      return Cell.Types.Hyperlink;\r\n    } else if (value.formula || value.sharedFormula) {\r\n      return Cell.Types.Formula;\r\n    } else if (value.richText) {\r\n      return Cell.Types.RichText;\r\n    } else if (value.sharedString) {\r\n      return Cell.Types.SharedString;\r\n    } else if (value.error) {\r\n      return Cell.Types.Error;\r\n    }\r\n    return Cell.Types.JSON;\r\n  },\r\n\r\n  // map valueType to constructor\r\n  types: [\r\n    {t: Cell.Types.Null, f: NullValue},\r\n    {t: Cell.Types.Number, f: NumberValue},\r\n    {t: Cell.Types.String, f: StringValue},\r\n    {t: Cell.Types.Date, f: DateValue},\r\n    {t: Cell.Types.Hyperlink, f: HyperlinkValue},\r\n    {t: Cell.Types.Formula, f: FormulaValue},\r\n    {t: Cell.Types.Merge, f: MergeValue},\r\n    {t: Cell.Types.JSON, f: JSONValue},\r\n    {t: Cell.Types.SharedString, f: SharedStringValue},\r\n    {t: Cell.Types.RichText, f: RichTextValue},\r\n    {t: Cell.Types.Boolean, f: BooleanValue},\r\n    {t: Cell.Types.Error, f: ErrorValue},\r\n  ].reduce((p, t) => { p[t.t] = t.f; return p; }, []),\r\n\r\n  create: function(type, cell, value) {\r\n    var T = this.types[type];\r\n    if (!T) {\r\n      throw new Error('Could not create Value of type ' + type);\r\n    }\r\n    return new T(cell, value);\r\n  }\r\n};\r\n"]}