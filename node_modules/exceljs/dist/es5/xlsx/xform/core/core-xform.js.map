{"version":3,"sources":["../../../../../lib/xlsx/xform/core/core-xform.js"],"names":["utils","require","XmlStream","BaseXform","DateXform","StringXform","IntegerXform","CoreXform","module","exports","map","tag","format","DateFormat","attrs","DateAttrs","dt","toISOString","replace","CORE_PROPERTY_ATTRIBUTES","inherits","render","xmlStream","model","openXml","StdDocAttributes","openNode","creator","title","subject","description","identifier","language","keywords","category","lastModifiedBy","lastPrinted","revision","version","contentStatus","contentType","created","modified","closeNode","parseOpen","node","parser","name","Error","JSON","stringify","parseText","text","parseClose","undefined"],"mappings":"AAAA;;;;;;AAMA;;AAEA,IAAIA,QAAQC,QAAQ,sBAAR,CAAZ;AACA,IAAIC,YAAYD,QAAQ,2BAAR,CAAhB;AACA,IAAIE,YAAYF,QAAQ,eAAR,CAAhB;AACA,IAAIG,YAAYH,QAAQ,sBAAR,CAAhB;AACA,IAAII,cAAcJ,QAAQ,wBAAR,CAAlB;AACA,IAAIK,eAAeL,QAAQ,yBAAR,CAAnB;;AAEA,IAAIM,YAAYC,OAAOC,OAAP,GAAiB,YAAW;AAC1C,OAAKC,GAAL,GAAW;AACT,kBAAc,IAAIL,WAAJ,CAAgB,EAACM,KAAK,YAAN,EAAhB,CADL;AAET,gBAAY,IAAIN,WAAJ,CAAgB,EAACM,KAAK,UAAN,EAAhB,CAFH;AAGT,kBAAc,IAAIN,WAAJ,CAAgB,EAACM,KAAK,YAAN,EAAhB,CAHL;AAIT,sBAAkB,IAAIN,WAAJ,CAAgB,EAACM,KAAK,gBAAN,EAAhB,CAJT;AAKT,qBAAiB,IAAIN,WAAJ,CAAgB,EAACM,KAAK,eAAN,EAAhB,CALR;AAMT,mBAAe,IAAIN,WAAJ,CAAgB,EAACM,KAAK,aAAN,EAAhB,CANN;AAOT,mBAAe,IAAIN,WAAJ,CAAgB,EAACM,KAAK,aAAN,EAAhB,CAPN;AAQT,mBAAe,IAAIN,WAAJ,CAAgB,EAACM,KAAK,aAAN,EAAhB,CARN;AAST,yBAAqB,IAAIN,WAAJ,CAAgB,EAACM,KAAK,mBAAN,EAAhB,CATZ;AAUT,sBAAkB,IAAIP,SAAJ,CAAc,EAACO,KAAK,gBAAN,EAAwBC,QAAQL,UAAUM,UAA1C,EAAd,CAVT;AAWT,mBAAe,IAAIP,YAAJ,CAAiB,EAACK,KAAK,aAAN,EAAjB,CAXN;AAYT,kBAAc,IAAIN,WAAJ,CAAgB,EAACM,KAAK,YAAN,EAAhB,CAZL;AAaT,wBAAoB,IAAIN,WAAJ,CAAgB,EAACM,KAAK,kBAAN,EAAhB,CAbX;AAcT,sBAAkB,IAAIN,WAAJ,CAAgB,EAACM,KAAK,gBAAN,EAAhB,CAdT;AAeT,uBAAmB,IAAIP,SAAJ,CAAc,EAACO,KAAK,iBAAN,EAAyBG,OAAOP,UAAUQ,SAA1C,EAAqDH,QAAQL,UAAUM,UAAvE,EAAd,CAfV;AAgBT,wBAAoB,IAAIT,SAAJ,CAAc,EAACO,KAAK,kBAAN,EAA0BG,OAAOP,UAAUQ,SAA3C,EAAsDH,QAAQL,UAAUM,UAAxE,EAAd;AAhBX,GAAX;AAkBD,CAnBD;;AAqBAN,UAAUM,UAAV,GAAuB,UAASG,EAAT,EAAa;AAClC,SAAOA,GAAGC,WAAH,GAAiBC,OAAjB,CAAyB,UAAzB,EAAqC,EAArC,CAAP;AACD,CAFD;AAGAX,UAAUQ,SAAV,GAAsB,EAAC,YAAY,gBAAb,EAAtB;;AAEAR,UAAUY,wBAAV,GAAqC;AACnC,cAAY,yEADuB;AAEnC,cAAY,kCAFuB;AAGnC,mBAAiB,2BAHkB;AAInC,oBAAkB,8BAJiB;AAKnC,eAAa;AALsB,CAArC;;AAQAnB,MAAMoB,QAAN,CAAeb,SAAf,EAA0BJ,SAA1B,EAAqC;AACnCkB,UAAQ,gBAASC,SAAT,EAAoBC,KAApB,EAA2B;AACjCD,cAAUE,OAAV,CAAkBtB,UAAUuB,gBAA5B;;AAEAH,cAAUI,QAAV,CAAmB,mBAAnB,EAAwCnB,UAAUY,wBAAlD;;AAEA,SAAKT,GAAL,CAAS,YAAT,EAAuBW,MAAvB,CAA8BC,SAA9B,EAAyCC,MAAMI,OAA/C;AACA,SAAKjB,GAAL,CAAS,UAAT,EAAqBW,MAArB,CAA4BC,SAA5B,EAAuCC,MAAMK,KAA7C;AACA,SAAKlB,GAAL,CAAS,YAAT,EAAuBW,MAAvB,CAA8BC,SAA9B,EAAyCC,MAAMM,OAA/C;AACA,SAAKnB,GAAL,CAAS,gBAAT,EAA2BW,MAA3B,CAAkCC,SAAlC,EAA6CC,MAAMO,WAAnD;AACA,SAAKpB,GAAL,CAAS,eAAT,EAA0BW,MAA1B,CAAiCC,SAAjC,EAA4CC,MAAMQ,UAAlD;AACA,SAAKrB,GAAL,CAAS,aAAT,EAAwBW,MAAxB,CAA+BC,SAA/B,EAA0CC,MAAMS,QAAhD;AACA,SAAKtB,GAAL,CAAS,aAAT,EAAwBW,MAAxB,CAA+BC,SAA/B,EAA0CC,MAAMU,QAAhD;AACA,SAAKvB,GAAL,CAAS,aAAT,EAAwBW,MAAxB,CAA+BC,SAA/B,EAA0CC,MAAMW,QAAhD;AACA,SAAKxB,GAAL,CAAS,mBAAT,EAA8BW,MAA9B,CAAqCC,SAArC,EAAgDC,MAAMY,cAAtD;AACA,SAAKzB,GAAL,CAAS,gBAAT,EAA2BW,MAA3B,CAAkCC,SAAlC,EAA6CC,MAAMa,WAAnD;AACA,SAAK1B,GAAL,CAAS,aAAT,EAAwBW,MAAxB,CAA+BC,SAA/B,EAA0CC,MAAMc,QAAhD;AACA,SAAK3B,GAAL,CAAS,YAAT,EAAuBW,MAAvB,CAA8BC,SAA9B,EAAyCC,MAAMe,OAA/C;AACA,SAAK5B,GAAL,CAAS,kBAAT,EAA6BW,MAA7B,CAAoCC,SAApC,EAA+CC,MAAMgB,aAArD;AACA,SAAK7B,GAAL,CAAS,gBAAT,EAA2BW,MAA3B,CAAkCC,SAAlC,EAA6CC,MAAMiB,WAAnD;AACA,SAAK9B,GAAL,CAAS,iBAAT,EAA4BW,MAA5B,CAAmCC,SAAnC,EAA8CC,MAAMkB,OAApD;AACA,SAAK/B,GAAL,CAAS,kBAAT,EAA6BW,MAA7B,CAAoCC,SAApC,EAA+CC,MAAMmB,QAArD;;AAEApB,cAAUqB,SAAV;AACD,GAxBkC;;AA0BnCC,aAAW,mBAASC,IAAT,EAAe;AACxB,QAAI,KAAKC,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACA,aAAO,IAAP;AACD;AACD,YAAQA,KAAKE,IAAb;AACE,WAAK,mBAAL;AACA,WAAK,gBAAL;AACE,eAAO,IAAP;AACF;AACE,aAAKD,MAAL,GAAc,KAAKpC,GAAL,CAASmC,KAAKE,IAAd,CAAd;AACA,YAAI,KAAKD,MAAT,EAAiB;AACf,eAAKA,MAAL,CAAYF,SAAZ,CAAsBC,IAAtB;AACA,iBAAO,IAAP;AACD;AACD,cAAM,IAAIG,KAAJ,CAAU,uCAAuCC,KAAKC,SAAL,CAAeL,IAAf,CAAjD,CAAN;AAVJ;AAYD,GA3CkC;AA4CnCM,aAAW,mBAASC,IAAT,EAAe;AACxB,QAAI,KAAKN,MAAT,EAAiB;AACf,WAAKA,MAAL,CAAYK,SAAZ,CAAsBC,IAAtB;AACD;AACF,GAhDkC;AAiDnCC,cAAY,oBAASN,IAAT,EAAe;AACzB,QAAI,KAAKD,MAAT,EAAiB;AACf,UAAI,CAAC,KAAKA,MAAL,CAAYO,UAAZ,CAAuBN,IAAvB,CAAL,EAAmC;AACjC,aAAKD,MAAL,GAAcQ,SAAd;AACD;AACD,aAAO,IAAP;AACD;AACD,YAAQP,IAAR;AACE,WAAK,mBAAL;AACA,WAAK,gBAAL;AACE,aAAKxB,KAAL,GAAa;AACXI,mBAAS,KAAKjB,GAAL,CAAS,YAAT,EAAuBa,KADrB;AAEXK,iBAAO,KAAKlB,GAAL,CAAS,UAAT,EAAqBa,KAFjB;AAGXM,mBAAS,KAAKnB,GAAL,CAAS,YAAT,EAAuBa,KAHrB;AAIXO,uBAAa,KAAKpB,GAAL,CAAS,gBAAT,EAA2Ba,KAJ7B;AAKXQ,sBAAY,KAAKrB,GAAL,CAAS,eAAT,EAA0Ba,KAL3B;AAMXS,oBAAU,KAAKtB,GAAL,CAAS,aAAT,EAAwBa,KANvB;AAOXU,oBAAU,KAAKvB,GAAL,CAAS,aAAT,EAAwBa,KAPvB;AAQXW,oBAAU,KAAKxB,GAAL,CAAS,aAAT,EAAwBa,KARvB;AASXY,0BAAgB,KAAKzB,GAAL,CAAS,mBAAT,EAA8Ba,KATnC;AAUXa,uBAAa,KAAK1B,GAAL,CAAS,gBAAT,EAA2Ba,KAV7B;AAWXc,oBAAU,KAAK3B,GAAL,CAAS,aAAT,EAAwBa,KAXvB;AAYXgB,yBAAe,KAAK7B,GAAL,CAAS,kBAAT,EAA6Ba,KAZjC;AAaXiB,uBAAa,KAAK9B,GAAL,CAAS,gBAAT,EAA2Ba,KAb7B;AAcXkB,mBAAS,KAAK/B,GAAL,CAAS,iBAAT,EAA4Ba,KAd1B;AAeXmB,oBAAU,KAAKhC,GAAL,CAAS,kBAAT,EAA6Ba;AAf5B,SAAb;AAiBA,eAAO,KAAP;AACF;AACE,cAAM,IAAIyB,KAAJ,CAAU,wCAAwCD,IAAlD,CAAN;AAtBJ;AAwBD;AAhFkC,CAArC","file":"core-xform.js","sourcesContent":["/**\r\n * Copyright (c) 2016 Guyon Roche\r\n * LICENCE: MIT - please refer to LICENCE file included with this module\r\n * or https://github.com/guyonroche/exceljs/blob/master/LICENSE\r\n */\r\n\r\n'use strict';\r\n\r\nvar utils = require('../../../utils/utils');\r\nvar XmlStream = require('../../../utils/xml-stream');\r\nvar BaseXform = require('../base-xform');\r\nvar DateXform = require('../simple/date-xform');\r\nvar StringXform = require('../simple/string-xform');\r\nvar IntegerXform = require('../simple/integer-xform');\r\n\r\nvar CoreXform = module.exports = function() {\r\n  this.map = {\r\n    'dc:creator': new StringXform({tag: 'dc:creator'}),\r\n    'dc:title': new StringXform({tag: 'dc:title'}),\r\n    'dc:subject': new StringXform({tag: 'dc:subject'}),\r\n    'dc:description': new StringXform({tag: 'dc:description'}),\r\n    'dc:identifier': new StringXform({tag: 'dc:identifier'}),\r\n    'dc:language': new StringXform({tag: 'dc:language'}),\r\n    'cp:keywords': new StringXform({tag: 'cp:keywords'}),\r\n    'cp:category': new StringXform({tag: 'cp:category'}),\r\n    'cp:lastModifiedBy': new StringXform({tag: 'cp:lastModifiedBy'}),\r\n    'cp:lastPrinted': new DateXform({tag: 'cp:lastPrinted', format: CoreXform.DateFormat}),\r\n    'cp:revision': new IntegerXform({tag: 'cp:revision'}),\r\n    'cp:version': new StringXform({tag: 'cp:version'}),\r\n    'cp:contentStatus': new StringXform({tag: 'cp:contentStatus'}),\r\n    'cp:contentType': new StringXform({tag: 'cp:contentType'}),\r\n    'dcterms:created': new DateXform({tag: 'dcterms:created', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat}),\r\n    'dcterms:modified': new DateXform({tag: 'dcterms:modified', attrs: CoreXform.DateAttrs, format: CoreXform.DateFormat})\r\n  };\r\n};\r\n\r\nCoreXform.DateFormat = function(dt) {\r\n  return dt.toISOString().replace(/[.]\\d{3}/, '');\r\n};\r\nCoreXform.DateAttrs = {'xsi:type': 'dcterms:W3CDTF'};\r\n\r\nCoreXform.CORE_PROPERTY_ATTRIBUTES = {\r\n  'xmlns:cp': 'http://schemas.openxmlformats.org/package/2006/metadata/core-properties',\r\n  'xmlns:dc': 'http://purl.org/dc/elements/1.1/',\r\n  'xmlns:dcterms': 'http://purl.org/dc/terms/',\r\n  'xmlns:dcmitype': 'http://purl.org/dc/dcmitype/',\r\n  'xmlns:xsi': 'http://www.w3.org/2001/XMLSchema-instance'\r\n};\r\n\r\nutils.inherits(CoreXform, BaseXform, {\r\n  render: function(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n\r\n    xmlStream.openNode('cp:coreProperties', CoreXform.CORE_PROPERTY_ATTRIBUTES);\r\n\r\n    this.map['dc:creator'].render(xmlStream, model.creator);\r\n    this.map['dc:title'].render(xmlStream, model.title);\r\n    this.map['dc:subject'].render(xmlStream, model.subject);\r\n    this.map['dc:description'].render(xmlStream, model.description);\r\n    this.map['dc:identifier'].render(xmlStream, model.identifier);\r\n    this.map['dc:language'].render(xmlStream, model.language);\r\n    this.map['cp:keywords'].render(xmlStream, model.keywords);\r\n    this.map['cp:category'].render(xmlStream, model.category);\r\n    this.map['cp:lastModifiedBy'].render(xmlStream, model.lastModifiedBy);\r\n    this.map['cp:lastPrinted'].render(xmlStream, model.lastPrinted);\r\n    this.map['cp:revision'].render(xmlStream, model.revision);\r\n    this.map['cp:version'].render(xmlStream, model.version);\r\n    this.map['cp:contentStatus'].render(xmlStream, model.contentStatus);\r\n    this.map['cp:contentType'].render(xmlStream, model.contentType);\r\n    this.map['dcterms:created'].render(xmlStream, model.created);\r\n    this.map['dcterms:modified'].render(xmlStream, model.modified);\r\n\r\n    xmlStream.closeNode();\r\n  },\r\n\r\n  parseOpen: function(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n    switch (node.name) {\r\n      case 'cp:coreProperties':\r\n      case 'coreProperties':\r\n        return true;\r\n      default:\r\n        this.parser = this.map[node.name];\r\n        if (this.parser) {\r\n          this.parser.parseOpen(node);\r\n          return true;\r\n        }\r\n        throw new Error('Unexpected xml node in parseOpen: ' + JSON.stringify(node));\r\n    }\r\n  },\r\n  parseText: function(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  },\r\n  parseClose: function(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'cp:coreProperties':\r\n      case 'coreProperties':\r\n        this.model = {\r\n          creator: this.map['dc:creator'].model,\r\n          title: this.map['dc:title'].model,\r\n          subject: this.map['dc:subject'].model,\r\n          description: this.map['dc:description'].model,\r\n          identifier: this.map['dc:identifier'].model,\r\n          language: this.map['dc:language'].model,\r\n          keywords: this.map['cp:keywords'].model,\r\n          category: this.map['cp:category'].model,\r\n          lastModifiedBy: this.map['cp:lastModifiedBy'].model,\r\n          lastPrinted: this.map['cp:lastPrinted'].model,\r\n          revision: this.map['cp:revision'].model,\r\n          contentStatus: this.map['cp:contentStatus'].model,\r\n          contentType: this.map['cp:contentType'].model,\r\n          created: this.map['dcterms:created'].model,\r\n          modified: this.map['dcterms:modified'].model\r\n        };\r\n        return false;\r\n      default:\r\n        throw new Error('Unexpected xml node in parseClose: ' + name);\r\n    }\r\n  }\r\n});\r\n"]}